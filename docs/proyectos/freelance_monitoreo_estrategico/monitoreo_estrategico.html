<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Monitoreo estratégico de la ejecución física y financiera – Portafolio de Jairo</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-86e726e9880ff8f8b8a1cabf46d04abc.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  /* Gráficas: que nunca se recorten */
  img, .quarto-figure {
    max-width: 100% !important;
    height: auto !important;
  }
  /* Bloques de código: permitir scroll horizontal */
  pre code {
    white-space: pre !important;
    overflow-x: auto !important;
    display: block;
  }
</style>


<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-BZ4HL1XQKX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-BZ4HL1XQKX');
</script>


</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Portafolio de Jairo</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Inicio</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-proyectos" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Proyectos</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-proyectos">    
        <li>
    <a class="dropdown-item" href="../../proyectos/tripleten_videogames_sprint6/tripleten_videogames_intro.html">
 <span class="dropdown-text">Mercado mundial de videojuegos</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../proyectos/freelance_monitoreo_estrategico/monitoreo_estrategico.html">
 <span class="dropdown-text">Seguimiento y monitoreo Plan Estratégico</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../contacto.html"> 
<span class="menu-text">Contacto</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#acerca-de-la-entidad" id="toc-acerca-de-la-entidad" class="nav-link active" data-scroll-target="#acerca-de-la-entidad">1. Acerca de la entidad</a></li>
  <li><a href="#proceso-de-seguimiento-y-evaluación-de-la-ejecución-del-plan-estratégico" id="toc-proceso-de-seguimiento-y-evaluación-de-la-ejecución-del-plan-estratégico" class="nav-link" data-scroll-target="#proceso-de-seguimiento-y-evaluación-de-la-ejecución-del-plan-estratégico">2. Proceso de seguimiento y evaluación de la ejecución del plan estratégico</a>
  <ul class="collapse">
  <li><a href="#estado-del-proceso-antes-de-la-intervención" id="toc-estado-del-proceso-antes-de-la-intervención" class="nav-link" data-scroll-target="#estado-del-proceso-antes-de-la-intervención">2.1 Estado del proceso antes de la intervención</a>
  <ul class="collapse">
  <li><a href="#informe-de-ejecución-presupuestal" id="toc-informe-de-ejecución-presupuestal" class="nav-link" data-scroll-target="#informe-de-ejecución-presupuestal">2.1.1 Informe de ejecución presupuestal</a></li>
  <li><a href="#informe-de-ejecución-física" id="toc-informe-de-ejecución-física" class="nav-link" data-scroll-target="#informe-de-ejecución-física">2.1.2 Informe de ejecución física</a></li>
  <li><a href="#principales-debilidades-del-modelo-actual" id="toc-principales-debilidades-del-modelo-actual" class="nav-link" data-scroll-target="#principales-debilidades-del-modelo-actual">2.1.3 Principales Debilidades del modelo actual</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#estado-del-proceso-después-de-la-intervención" id="toc-estado-del-proceso-después-de-la-intervención" class="nav-link" data-scroll-target="#estado-del-proceso-después-de-la-intervención">3. Estado del proceso después de la intervención</a>
  <ul class="collapse">
  <li><a href="#definición-del-flujo-de-datos" id="toc-definición-del-flujo-de-datos" class="nav-link" data-scroll-target="#definición-del-flujo-de-datos">3.1 Definición del flujo de datos</a>
  <ul class="collapse">
  <li><a href="#avance-físico" id="toc-avance-físico" class="nav-link" data-scroll-target="#avance-físico">3.1.1 Avance Físico</a></li>
  <li><a href="#avance-financiero" id="toc-avance-financiero" class="nav-link" data-scroll-target="#avance-financiero">3.1.2 Avance Financiero</a></li>
  <li><a href="#avance-físico-rezagado" id="toc-avance-físico-rezagado" class="nav-link" data-scroll-target="#avance-físico-rezagado">3.1.3 Avance Físico Rezagado</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusiones-generales" id="toc-conclusiones-generales" class="nav-link" data-scroll-target="#conclusiones-generales">4. Conclusiones Generales</a>
  <ul class="collapse">
  <li><a href="#oportunidades-de-mejora" id="toc-oportunidades-de-mejora" class="nav-link" data-scroll-target="#oportunidades-de-mejora">4.1 Oportunidades de mejora</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Monitoreo estratégico de la ejecución física y financiera</h1>
</div>



<div class="quarto-title-meta column-page-left">

    
  
    
  </div>
  


</header>


<hr>
<section id="acerca-de-la-entidad" class="level1">
<h1>1. Acerca de la entidad</h1>
<p>La entidad estudiada es de carácter público del orden territorial y se dedica a gestionar proyectos ambientales, además de supervisar la labor de otros entes territoriales y de la comunidad dentro de su jurisdicción. Sus periodos administrativos cambian cada 4 años, y en cada uno se formula un plan estratégico ajustado a la capacidad financiera disponible. El Área de Planeación y Proyectos lidera la formulación de este plan, el plan financiero o de inversión, y el seguimiento al cumplimiento del presupuesto y de las metas definidas.</p>
<p>En general, los planes estratégicos suelen organizarse en diferentes niveles como líneas, ejes, programas, subprogramas, proyectos y productos. En el caso de esta entidad, la estructura de su plan se observa así:</p>
<ul>
<li>Líneas estratégicas<br>
</li>
<li>Programas<br>
</li>
<li>Proyectos<br>
</li>
<li>Productos</li>
</ul>
<p>El proceso analizado en este proyecto parte del plan estratégico, que cada año sirve de base para los planes de acción y el presupuesto anual. A partir de allí, cada área responsable ejecuta sus actividades con los recursos asignados. El Área de Planeación y Proyectos se encarga de dar seguimiento al cumplimiento de metas y evaluar el avance en productos, proyectos, programas, líneas estratégicas y áreas responsables.</p>
<p>Existen algunas particularidades en este proceso de seguimiento:</p>
<ul>
<li><p>Al inicio de cada periodo administrativo (cuatrienio) se realiza una armonización presupuestal: se ajusta el presupuesto heredado de la administración anterior al nuevo plan estratégico. Aunque se hace una sola vez, es clave para calcular correctamente la ejecución acumulada del plan.</p></li>
<li><p>También existe el reporte de avance físico rezagado: se registran metas cumplidas en la vigencia anterior que no pudieron reportarse a tiempo por falta de información o por la dinámica propia de la entidad. Esto puede modificar los resultados presentados al cierre de un año durante los primeros meses del siguiente.</p></li>
</ul>
<p>Finalmente, el Área de Planeación y Proyectos debe presentar a la junta directiva los resultados de ejecución, tanto anuales como acumulados. Entre las preguntas que se responden están: ¿cómo va la ejecución del presupuesto?, ¿cómo avanza la inversión y la producción?, ¿qué tanto se ha logrado en los productos?, ¿qué áreas presentan retrasos?, ¿cómo se ve la ejecución a nivel de proyectos y programas?</p>
<hr>
</section>
<section id="proceso-de-seguimiento-y-evaluación-de-la-ejecución-del-plan-estratégico" class="level1">
<h1>2. Proceso de seguimiento y evaluación de la ejecución del plan estratégico</h1>
<section id="estado-del-proceso-antes-de-la-intervención" class="level2">
<h2 class="anchored" data-anchor-id="estado-del-proceso-antes-de-la-intervención">2.1 Estado del proceso antes de la intervención</h2>
<p>La entidad cuenta con un ERP integral en el que se gestionan los datos generados por los procesos (movimiento operacional), entre ellos la ejecución del presupuesto, la ejecución contractual (adquisición de bienes y servicios), la ejecución de los planes de acción, entre otros. El ERP centraliza la mayor parte de los datos y facilita la generación de reportes que sirven como insumo para productos como los informes a los entes de control, las entidades de gobierno del orden nacional, los informes de gestión institucional presentados a la junta directiva y aquellos que hacen parte de las obligaciones de transparencia y acceso a la información.</p>
<p>Sin embargo, en el caso de los informes de gestión institucional, el procesamiento de datos es manual y se realiza en Excel desde el Área de Planeación y Proyectos. Existen archivos Excel “maestros” que se han venido construyendo y ampliando a medida que se generan más datos y que se requiere nueva información. Estos archivos se alimenta de los reportes generados por el ERP mediante la acción de “copiar” y “pegar” la información actualizada.</p>
<p>Los Excel maestro contiene varias hojas de cálculo con diversa información, relacionadas entre sí a través de referencias. El cálculo de resultados o indicadores se realiza mediante fórmulas por fila y por columna. Para llegar a estos resultados, se hace una limpieza de datos que en algunos casos es manual (buscar y reemplazar) y en otros se apoya en fórmulas como concatenar, extraer, izquierda, derecha, entre otras.</p>
<p>Si bien se logra el objetivo, los archivos Excel maestros resultan complejos debido a la cantidad de hojas y lentos por el número de fórmulas. Además, la visualización de datos es limitada y los resultados se presentan principalmente mediante filtros de tablas (segmentadores o <em>slicers</em>).</p>
<p>El siguiente esquema refleja el proceso actual:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Ilustracion_proceso_inicial.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<p>Cabe resaltar que existen dos archivos Excel “maestros”: uno se enfoca en el análisis, seguimiento y evaluación de la gestión presupuestal (informe de ejecución presupuestal), y el otro en la gestión del plan estratégico (Informe de ejecución física), considerando las líneas, programas, proyectos y productos en relación con su avance.</p>
<section id="informe-de-ejecución-presupuestal" class="level3">
<h3 class="anchored" data-anchor-id="informe-de-ejecución-presupuestal">2.1.1 Informe de ejecución presupuestal</h3>
<p>El archivo está compuesto por 39 hojas, en las cuales se consolida información presupuestal clave. Incluye datos sobre disponibilidades, compromisos, pagos, asignación de recursos por producto y fuentes de financiación, así como una matriz de avance financiero y un dashboard con detalles del progreso financiero.</p>
<p>Cabe aclarar que algunas hojas no están nombradas explícitamente según su contenido, sino que utilizan títulos abreviados, técnicos o referenciales. Por ejemplo:</p>
<p>- TD_CDPS, N_CDPS, TD_QGasto, TD_Prod, TD_Act</p>
<p>- Disponible_Banco 13022024, Exc_prod, Graficos</p>
<p>- CPI_POAI_2025_Ejec, Proyectos en cero RP, A2. Metas</p>
<p>- Fuentes, 7. Liberar, 1.Estado (2025)</p>
<p>Estas denominaciones reflejan estructuras internas del seguimiento financiero, pero no siempre permiten identificar de forma directa el tipo de información contenida. Por ello, se recomienda complementar el análisis con una tabla de descripción de hojas o un índice temático.</p>
<p><img src="images/paste-4.png" class="img-fluid"></p>
<p><img src="images/paste-5.png" class="img-fluid"></p>
<p><img src="images/paste-6.png" class="img-fluid"></p>
<p><img src="images/paste-7.png" class="img-fluid"></p>
</section>
<section id="informe-de-ejecución-física" class="level3">
<h3 class="anchored" data-anchor-id="informe-de-ejecución-física">2.1.2 Informe de ejecución física</h3>
<p>El archivo está compuesto por 58 hojas, en las cuales se consolida información clave relacionada con la ejecución física de los planes institucionales. Incluye elementos como el catálogo de productos, la matriz estratégica, el plan de acción por vigencia, el plan de inversiones, el plan indicativo (detalle de los indicadores), la programación financiera por vigencia, y la matriz de seguimiento a la ejecución física, entre otros.</p>
<p>Cabe destacar que algunas hojas presentan nombres técnicos o abreviados que no reflejan directamente su contenido temático. Por ejemplo:</p>
<p>- Catálogo de Productos (06-2024)</p>
<p>- PAC_$ solicVsProg, PAC_Comparativo a línea proy, PAC_x Plan Indicativo</p>
<p>- POAI 2024, CPI_POAI_vertical, CPI_POAI_Horz</p>
<p>- PAI 2024-2027, PAI 2024-2027 MinAmb</p>
<p>- PAC_x Fisco Nueva Subdir, PAC_x Retos (SEAPAC)</p>
<p>- Articulación, Actividades, CodSector</p>
<p>Estas denominaciones responden a estructuras internas de planificación, seguimiento y articulación institucional.</p>
<p><img src="images/paste-2.png" class="img-fluid"></p>
<p><img src="images/paste-3.png" class="img-fluid"></p>
<p><img src="images/paste-8.png" class="img-fluid"></p>
</section>
<section id="principales-debilidades-del-modelo-actual" class="level3">
<h3 class="anchored" data-anchor-id="principales-debilidades-del-modelo-actual">2.1.3 Principales Debilidades del modelo actual</h3>
<p>El modelo actual presenta diversas limitaciones que afectan la eficiencia, la trazabilidad y la calidad de la información gestionada. Entre las principales debilidades se destacan:</p>
<ul>
<li><p><strong>Alta carga de trabajo manual</strong>: La actualización de la información en cada archivo Excel requiere una intervención constante, lo que incrementa el riesgo de errores y dificulta la sostenibilidad del sistema.</p></li>
<li><p><strong>Duplicidad de información</strong>: La creación de hojas separadas para detallar datos por “dimensiones” genera redundancia y fragmentación, complicando el análisis integral.</p></li>
<li><p><strong>Complejidad técnica</strong>: El uso intensivo de fórmulas internas, su cantidad y variedad, junto con un número considerable de tablas dinámicas, dificulta la comprensión del funcionamiento general de los archivos y limita su mejora colaborativa.</p></li>
<li><p><strong>Dependencia del funcionario elaborador</strong>: La ausencia de documentación sobre la trazabilidad de elaboración y mantenimiento de los archivos genera una alta dependencia del funcionario que los diseñó, lo que representa un riesgo operativo.</p></li>
<li><p><strong>Desconexión entre ejecución física y financiera</strong>: No existe una integración entre los documentos que permita relacionar de forma automática la información física y financiera por meta, lo que obliga a construir manualmente los informes consolidados solicitados por la Junta Directiva.</p></li>
<li><p><strong>Inconsistencia en los códigos de proyecto</strong>: Se utilizan códigos distintos para la ejecución física y la información financiera, lo que dificulta el cruce de datos.</p></li>
<li><p><strong>Falta de estandarización</strong>: Existen variaciones en la codificación, como el uso inconsistente de puntos finales en los códigos, lo que afecta la uniformidad de los registros.</p></li>
<li><p><strong>Dificultad para vincular proyectos con fuentes de financiación</strong>: La estructura actual genera columnas por cada fuente de financiación que se repiten en múltiples hojas (por líneas estratégicas, programas, etc.), lo que provoca duplicidad de fuentes (una misma fuente con diferentes códigos).</p></li>
<li><p><strong>Problemas de homologación en el catálogo de productos</strong>: El catálogo requiere múltiples códigos para traducir la información según los requerimientos de entidades externas, cada una con su propio sistema de codificación. Esto obliga a realizar procesos de homologación manual.</p></li>
<li><p><strong>Desalineación con el ERP institucional</strong>: Se han identificado archivos Excel paralelos, elaborados para responder a requerimientos de entes externos, que contienen información del avance físico y financiero distinta a la registrada en el ERP. Esta situación compromete la integridad, calidad y oportunidad de los datos utilizados para evaluar la gestión.</p></li>
<li><p><strong>Riesgo por actualizaciones parciales</strong>: La modificación en el alcance de un producto exige actualizar múltiples variables físicas (meta física, ponderaciones por cuatrienio y vigencia, responsable de ejecución, etc.) y financieras (asignación total, por fuente y por vigencia) en diferentes hojas. Si alguna de estas no se actualiza correctamente, los resultados reportados pueden ser inconsistentes o erróneos.</p></li>
</ul>
<hr>
</section>
</section>
</section>
<section id="estado-del-proceso-después-de-la-intervención" class="level1">
<h1>3. Estado del proceso después de la intervención</h1>
<p>Tras el análisis del proceso y la revisión de las diferentes fuentes de datos, se identificó cómo se genera la información desde el ERP. Con base en ello, se diseñó un proceso de transformación de datos semiautomático, utilizando exclusivamente las herramientas disponibles en la entidad —en este caso, Excel—, dado que no existen recursos para adquirir o arrendar servicios adicionales.</p>
<p>La principal necesidad detectada es la integración de la información, es decir, contar con la capacidad de consolidar en un solo informe la ejecución física y la presupuestal. Cabe señalar que la información presupuestal puede generarse de manera diaria, mientras que los reportes de ejecución física se actualizan trimestralmente. Esta diferencia en la periodicidad exige un modelo flexible que permita armonizar ambas fuentes.</p>
<p>Para lograr la mejora se desarrollaron las siguientes etapas:</p>
<p>- Identificación de las fuentes de información</p>
<p>- Clasificación de datos por hechos y dimensiones</p>
<p>- Construcción de tablas de dimensiones</p>
<p>- Transformación de la información presupuestal</p>
<p>- Transformación de la información de ejecución física</p>
<p>- Integración de la información y consolidación del modelo de datos</p>
<p>- Definición de métricas</p>
<section id="definición-del-flujo-de-datos" class="level2">
<h2 class="anchored" data-anchor-id="definición-del-flujo-de-datos">3.1 Definición del flujo de datos</h2>
<p>Una vez comprendido el proceso de transformación de la información y definidos los datos necesarios para elaborar el informe, se diseñó un esquema de flujo de datos teniendo en cuenta las limitaciones de Excel en procesos de transformación extensos. Inicialmente, el procedimiento se centralizó en un único bloque; sin embargo, el rendimiento obtenido no fue el esperado. Por esta razón, se decidió dividir el flujo en dos etapas, lo que permitió optimizar la eficiencia y facilitar el manejo de la información: la primera dedicada a la transformación de las tablas de hechos y la segunda a la integración del modelo de datos con las tablas de hechos y dimensiones.</p>
<p>Cabe destacar que las tablas de dimensiones fueron construidas manualmente y son gestionadas por el Área de Planeación y Proyectos de la misma manera. Por ejemplo, si una meta de producto sufre modificaciones en su alcance o se incorpora un nuevo producto, estos cambios deben ajustarse manualmente en la tabla de dimensión correspondiente.</p>
<p><img src="Ilustracion_flujo_datos.png" class="img-fluid"></p>
<p>La vista de diagrama de datos, de la segunda etapa, que proporciona Power Pivot se observa así:</p>
<p><img src="images/paste-9.png" class="img-fluid"></p>
<section id="avance-físico" class="level3">
<h3 class="anchored" data-anchor-id="avance-físico">3.1.1 Avance Físico</h3>
<p>Para el seguimiento del plan estratégico se definieron cuatro medidas, orientadas a mostrar tanto la ejecución de los productos como la actualización de la información disponible.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 34%">
<col style="width: 65%">
</colgroup>
<thead>
<tr class="header">
<th>Medida</th>
<th>Detalle</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Actualizacion</td>
<td>Extrae la fecha de la última actualización de los datos de avance en la ejecución de los productos del plan estratégico.</td>
</tr>
<tr class="even">
<td>EjecucionGlobal</td>
<td>Suma la ejecución ponderada global de los cuatro años del periodo administrativo en curso, asignando un peso del 25% a cada año.</td>
</tr>
<tr class="odd">
<td>EjecucionPonderadaGlobal</td>
<td>Calcula el porcentaje de ejecución de los productos considerando el peso asignado en el plan estratégico (el peso de cada producto dentro del cuatrienio). El valor incluye los rezagos agregados posteriormente.</td>
</tr>
<tr class="even">
<td>EjecucionReal</td>
<td>Calcula el porcentaje de ejecución de los productos considerando el peso asignado en la vigencia (el peso de cada producto para un año específico). El valor incluye los rezagos agregados posteriormente.</td>
</tr>
</tbody>
</table>
<p>El desarrollo de la fórmula de una de las medidas aplicadas al avance físico se muestra a continuación.</p>
<hr>
<pre class="dax"><code>EjecucionReal:=

VAR VigenciaMax=
    MAX(Fct_AvanceFisico[Vigencia])
    
VAR FechaMax=
    MAX(Fct_AvanceFisico[Fecha_Corte])

RETURN

VAR TablaFiltrada =
 FILTER(
 Fct_AvanceFisico,
 Fct_AvanceFisico[Vigencia] = VigenciaMax &amp;&amp;
 INT(Fct_AvanceFisico[Fecha_Corte]) = FechaMax
 )
RETURN

DIVIDE(
 SUMX(
 TablaFiltrada,
 VAR Vigencia = Fct_AvanceFisico[Vigencia]

 VAR Meta =
 SWITCH(
 TRUE(),
 Vigencia = 2024, RELATED(Dim_Productos[Meta_2024]),
 Vigencia = 2025, RELATED(Dim_Productos[Meta_2025]),
 Vigencia = 2026, RELATED(Dim_Productos[Meta_2026]),
 Vigencia = 2027, RELATED(Dim_Productos[Meta_2027])
 )
 
 VAR Avance =
 DIVIDE((Fct_AvanceFisico[Avance_Fisico]), Meta, 0)

 VAR Ejecucion =
 IF(Avance &gt; 1, 1, Avance)

 VAR Ponderado =
 SWITCH(
 TRUE(),
 Vigencia = 2024, Fct_AvanceFisico[Pond_2024],
 Vigencia = 2025, Fct_AvanceFisico[Pond_2025],
 Vigencia = 2026, Fct_AvanceFisico[Pond_2026],
 Vigencia = 2027, Fct_AvanceFisico[Pond_2027]
 )

 RETURN Ejecucion * Ponderado
 ),
 SUMX(
 TablaFiltrada,
 VAR Vigencia = Fct_AvanceFisico[Vigencia]

 VAR Ponderado =
 SWITCH(
 TRUE(),
 Vigencia = 2024, Fct_AvanceFisico[Pond_2024],
 Vigencia = 2025, Fct_AvanceFisico[Pond_2025],
 Vigencia = 2026, Fct_AvanceFisico[Pond_2026],
 Vigencia = 2027, Fct_AvanceFisico[Pond_2027]
 )

 RETURN Ponderado
 ),
 0
) +

SWITCH(
 TRUE(),
 VigenciaMax = 2024, [AvanceRezago2024],
 VigenciaMax = 2025, [AvanceRezago2025],
 VigenciaMax = 2026, [AvanceRezago2026],
 VigenciaMax = 2027, [AvanceRezago2027]
 )</code></pre>
<hr>
</section>
<section id="avance-financiero" class="level3">
<h3 class="anchored" data-anchor-id="avance-financiero">3.1.2 Avance Financiero</h3>
<p>En el flujo de datos se definieron inicialmente 27 medidas relacionadas con el avance financiero. Sin embargo, se han identificado oportunidades de mejora que permitirían reducir su número a menos de la mitad, manteniendo la consistencia y precisión en el análisis.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;">Medida</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Ppto_Inicial</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ppto_Tramite</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ppto_Definitivo</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ppto_Certificado</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ppto_Comprometido</td>
</tr>
<tr class="even">
<td style="text-align: left;">Ppto_Obligado</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Ppto_Pagado</td>
</tr>
</tbody>
</table>
<p>Cada una de estas medidas funciona como la sumatoria de los distintos momentos presupuestales. Los valores se presentan en millones de pesos, por lo que la sumatoria se divide posteriormente entre un millón para mantener una escala adecuada para su análisis.</p>
<ul>
<li><p>Inicial: Corresponde a los valores aprobados por la junta directiva como montos financieros asignados para iniciar una vigencia.</p></li>
<li><p>Trámite: Representa los valores del presupuesto que están en proceso de modificación del presupuesto inicial (adiciones, reducciones, traslados).</p></li>
<li><p>Definitivo: Agrupa el presupuesto inicial junto con las modificaciones aprobadas por la junta directiva.</p></li>
<li><p>Certificado: Valores asignados para futuros compromisos financieros. Certifican que existe disponibilidad presupuestal para cubrir adquisiciones de bienes o servicios respaldadas por contratos.</p></li>
<li><p>Comprometido: Recursos destinados a respaldar la adquisición de bienes o servicios con soporte contractual.</p></li>
<li><p>Obligado: Valores reconocidos como deuda, que deben ser pagados al tercero que suministró bienes o prestó servicios contratados.</p></li>
<li><p>Pagado: Valores ya transferidos o girados al tercero proveedor del bien o servicio, previamente reconocidos como obligación.</p></li>
</ul>
<p>De las medidas presupuestales previamente definidas se desprenden los cálculos en porcentaje, los cuales permiten analizar la relación de cada momento presupuestal respecto al Ppto_Definitivo:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Medida</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Porc_Tramite</td>
</tr>
<tr class="even">
<td>Porc_Certificado</td>
</tr>
<tr class="odd">
<td>Porc_Comprometido</td>
</tr>
<tr class="even">
<td>Porc_Obligado</td>
</tr>
</tbody>
</table>
<p>Estos porcentajes se calculan en función del Ppto_Definitivo, lo que asegura consistencia en la comparación de los distintos momentos presupuestales.</p>
<p>El siguiente grupo de medidas mantiene la misma lógica, pero se limita exclusivamente a la información presupuestal de la vigencia en curso (VA):</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Medida</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Ppto_Inicial_VA</td>
</tr>
<tr class="even">
<td>Ppto_Tramite_VA</td>
</tr>
<tr class="odd">
<td>Ppto_Definitivo_VA</td>
</tr>
<tr class="even">
<td>Ppto_Certificado_VA</td>
</tr>
<tr class="odd">
<td>Ppto_Comprometido_VA</td>
</tr>
<tr class="even">
<td>Ppto_Obligado_VA</td>
</tr>
<tr class="odd">
<td>Ppto_Pagado_VA</td>
</tr>
<tr class="even">
<td>Porc_Tramite_VA</td>
</tr>
<tr class="odd">
<td>Porc_Certificado_VA</td>
</tr>
<tr class="even">
<td>Porc_Comprometido_VA</td>
</tr>
<tr class="odd">
<td>Porc_Obligado_VA</td>
</tr>
</tbody>
</table>
<p>Finalmente, se cuenta con un conjunto de medidas que funcionan de manera transversal dentro del modelo. En varios casos se utilizan más como variables de apoyo para el cálculo de otras medidas, aportando consistencia y precisión en los resultados.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 43%">
<col style="width: 56%">
</colgroup>
<thead>
<tr class="header">
<th>Medida</th>
<th>Detalle</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>EsperadoEjecutado</td>
<td>Calcula el valor de ejecución presupuestal que debería llevar la entidad hasta el mes finalizado en la vigencia actual</td>
</tr>
<tr class="even">
<td>Porc_Ejec_Esperado</td>
<td>Calcula el porcentaje del presupuesto ejecutado (obligación) en función de <em>EsperadoEjecutado</em>.</td>
</tr>
<tr class="odd">
<td>FechaMaxFin</td>
<td>Extrae la fecha de la última actualización de los datos de ejecución presupuestal.</td>
</tr>
<tr class="even">
<td>MesVencido</td>
<td>Extrae el último mes de la vigencia que ya culminó; se utiliza como variable necesaria para calcular <em>EsperadoEjecutado</em>.</td>
</tr>
<tr class="odd">
<td>VigenciaActFin</td>
<td>Extrae el año de la actualización más reciente de los datos de ejecución presupuestal.</td>
</tr>
</tbody>
</table>
<p>El desarrollo de la fórmula de unas de las medidas aplicadas al avance financiero se muestra a continuación.</p>
<hr>
<pre class="dax"><code>Ppto_Definitivo:=
DIVIDE(
    sum(
        Fct_AvanceFinanciero[2_Apropiado_Final]),
        1000000,
        0)</code></pre>
<hr>
<pre class="dax"><code>Ppto_Definitivo_VA:=
VAR FechaMax = [FechaMaxFin]
VAR VigenciaActual = [VigenciaActFin]
VAR TablaFiltrada =
     FILTER(
     Fct_AvanceFinanciero,
     Fct_AvanceFinanciero[Vigencia] = VigenciaActual &amp;&amp;
     INT(Fct_AvanceFinanciero[Fecha_Corte]) = FechaMax
     )
RETURN
SUMX(
     TablaFiltrada,
     [Ppto_Definitivo]
)</code></pre>
<hr>
<pre class="dax"><code>EsperadoEjecutado:=
DIVIDE(
    [Ppto_Definitivo_VA],
    12,
    0)
*
[MesVencido]</code></pre>
<hr>
</section>
<section id="avance-físico-rezagado" class="level3">
<h3 class="anchored" data-anchor-id="avance-físico-rezagado">3.1.3 Avance Físico Rezagado</h3>
<p>Como parte del seguimiento al plan estratégico, es necesario incluir los reportes de avance de productos generados una vez finalizada cada vigencia. En la vigencia actual se reporta la ejecución de los productos logrados en la vigencia anterior, los cuales deben registrarse como avances de la vigencia presente y no de aquella en la que se produce el reporte.</p>
<p>En el caso de la <strong>ejecución rezagada</strong>, se definen dos grupos de medidas</p>
<ul>
<li>Medidas asociadas a la ponderación de cada producto en la vigencia (EjecucionReal):</li>
</ul>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Medida</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>AvanceRezago2024</td>
</tr>
<tr class="even">
<td>AvanceRezago2025</td>
</tr>
<tr class="odd">
<td>AvanceRezago2026</td>
</tr>
<tr class="even">
<td>AvanceRezago2027</td>
</tr>
</tbody>
</table>
<p>Estas medidas calculan el aporte de los avances rezagados frente a los ponderados de cada vigencia y se integran en el cálculo de la medida EjecucionReal.</p>
<ul>
<li>Medidas asociadas a la ponderación del producto en el cuatrienio (EjecucionPonderadaGlobal):</li>
</ul>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Medida</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>AvanceRezago2024_PondCuatrienio</td>
</tr>
<tr class="even">
<td>AvanceRezago2025_PondCuatrienio</td>
</tr>
<tr class="odd">
<td>AvanceRezago2026_PondCuatrienio</td>
</tr>
<tr class="even">
<td>AvanceRezago2027_PondCuatrienio</td>
</tr>
</tbody>
</table>
<p>Este grupo de medidas incorpora los avances rezagados considerando los ponderados del cuatrienio, para que sean incluidos en el cálculo de la medida EjecucionPonderadaGlobal.</p>
<p>Es importante tener en cuenta que los ponderados de producto por vigencia no necesariamente coinciden con los ponderados del cuatrienio. Esto ocurre porque existen metas que no se programan en las cuatro vigencias. Cuando un producto no se programa en una vigencia, su ponderación es cero y no se incluye en el cálculo de EjecucionReal de esa vigencia; además, la meta considerada es únicamente la de ese periodo. En cambio, en el cálculo de EjecucionPonderadaGlobal, la meta del producto sí se tiene en cuenta, aunque no haya sido programada en una vigencia específica, ya que se evalúa con base en la meta total del cuatrienio.</p>
<p>El desarrollo de la fórmula de unas de las medidas aplicadas al avance físico de rezago se muestra a continuación.</p>
<hr>
<pre class="dax"><code>AvanceRezago2024:=
VAR VigenciaMax=2024
        
VAR FechaMax=
    MAX(Fct_AvanceFisico_Rezago[Corte_Reporte])

RETURN

VAR TablaFiltrada =
 FILTER(
 Fct_AvanceFisico_Rezago,
 YEAR(Fct_AvanceFisico_Rezago[Corte_Rezago]) = VigenciaMax 
 &amp;&amp;
 INT(Fct_AvanceFisico_Rezago[Corte_Reporte]) = FechaMax
 )
 
RETURN

DIVIDE(
 SUMX(
 TablaFiltrada,
 VAR Vigencia = 2024

 VAR Meta = 
    RELATED(Dim_Productos[Meta_2024]) 
 
 VAR AvanceRes =
 DIVIDE((Fct_AvanceFisico_Rezago[Avance_Rezago]), Meta, 0)

 VAR Ejecucion =
 IF(AvanceRes &gt; 1, 1, AvanceRes)

 VAR Ponderado = 
    Fct_AvanceFisico_Rezago[Pond_2024]

 RETURN Ejecucion * Ponderado
 ),
 SUMX(
 TablaFiltrada,
 VAR Vigencia = YEAR(Fct_AvanceFisico_Rezago[Corte_Rezago])

 VAR Ponderado = Fct_AvanceFisico_Rezago[Pond_2024]
 
 RETURN Ponderado
 ),
 0
)</code></pre>
<hr>
<pre class="dax"><code>AvanceRezago2024_PondCuatrienio:=
VAR VigenciaMax=2024
        
VAR FechaMax=
    MAX(Fct_AvanceFisico_Rezago[Corte_Reporte])

RETURN

VAR TablaFiltrada =
 FILTER(
 Fct_AvanceFisico_Rezago,
 YEAR(Fct_AvanceFisico_Rezago[Corte_Rezago]) = VigenciaMax 
 &amp;&amp;
 INT(Fct_AvanceFisico_Rezago[Corte_Reporte]) = FechaMax
 )
 
RETURN

DIVIDE(
 SUMX(
 TablaFiltrada,
 VAR Vigencia = 2024

 VAR Meta = 
    RELATED(Dim_Productos[Meta_2024]) 
 
 VAR AvanceRes =
 DIVIDE((Fct_AvanceFisico_Rezago[Avance_Rezago]), Meta, 0)

 VAR Ejecucion =
 IF(AvanceRes &gt; 1, 1, AvanceRes)

 VAR Ponderado = 
    Fct_AvanceFisico_Rezago[Pond_Cuatrienio]

 RETURN Ejecucion * Ponderado
 ),
 SUMX(
 TablaFiltrada,
 VAR Vigencia = YEAR(Fct_AvanceFisico_Rezago[Corte_Rezago])

 VAR Ponderado = Fct_AvanceFisico_Rezago[Pond_Cuatrienio]
 
 RETURN Ponderado
 ),
 0
)</code></pre>
<hr>
</section>
</section>
</section>
<section id="conclusiones-generales" class="level1">
<h1>4. Conclusiones Generales</h1>
<p>La implementación del nuevo proceso de gestión de información presupuestal y física del plan estratégico ha mejorado significativamente la capacidad de la entidad para compartir resultados de manera más sencilla, facilitar la administración de datos y mantener la información actualizada al ritmo de los reportes generados desde el ERP.</p>
<p>Aunque aún existe una parte del proceso que se gestiona de forma manual —debido a las limitaciones del ERP, que no permite la conexión directa con Excel para consultas automáticas—, el orden alcanzado hace que el sistema sea más fácil de administrar y abre dos nuevas posibilidades para la entidad:</p>
<ul>
<li><p><strong>Fortalecer el ERP</strong> mediante el desarrollo de herramientas de visualización basadas en el flujo de datos estructurado en este proyecto. El proveedor del ERP ha manifestado interés en avanzar en este tipo de mejoras, lo que representa una oportunidad estratégica.</p></li>
<li><p><strong>Implementar visualización y storytelling en Power B</strong>I para la ejecución presupuestal y física del plan estratégico. Aunque la entidad no cuenta con una suscripción corporativa ni ha asignado recursos específicos, el uso de la versión gratuita puede ser un punto de partida para impulsar decisiones estratégicas más informadas.</p></li>
</ul>
<p>Los avances logrados hasta ahora facilitan la adopción de cualquiera de estas dos alternativas.</p>
<section id="oportunidades-de-mejora" class="level2">
<h2 class="anchored" data-anchor-id="oportunidades-de-mejora">4.1 Oportunidades de mejora</h2>
<ul>
<li><p><strong>Complementar las medidas con niveles de aceptación</strong>, de manera que se construyan KPIs completos y más representativos.</p></li>
<li><p><strong>Simplificar algunas medidas</strong>, dado que el modelo actual ya satisface las necesidades de la junta directiva y la gerencia, pero podría optimizarse para reducir complejidad sin perder valor informativo.</p></li>
<li><p><strong>Explorar alternativas de escalabilidad y acceso</strong>, como el uso de Python para procesos de transformación y visualización. Esto permitiría aprovechar herramientas gratuitas y la infraestructura física disponible en la entidad, ampliando el alcance del modelo hacia todos los niveles organizacionales.</p></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>